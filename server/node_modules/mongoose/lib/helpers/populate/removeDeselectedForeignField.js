'use strict';

const get = require('../get');
const mpath = require('mpath');
const parseProjection = require('../projection/parseProjection');

/*!
 * ignore
 */

module.exports = function removeDeselectedForeignField(foreignFields, options, docs) {
  const projection = parseProjection(get(options, 'select', null), true) ||
    parseProjection(get(options, 'options.select', null), true);

  if (projection == null) {
    return;
  }
  for (const foreignField of foreignFields) {
<<<<<<< HEAD
    if (!projection.hasOwnProperty('-' + foreignField)) {
=======
<<<<<<< HEAD
    if (!projection.hasOwnProperty('-' + foreignField)) {
=======
<<<<<<< HEAD
    if (!projection.hasOwnProperty('-' + foreignField)) {
=======
<<<<<<< HEAD
    if (!projection.hasOwnProperty('-' + foreignField)) {
=======
    if (!Object.hasOwn(projection, '-' + foreignField)) {
>>>>>>> 15bede01c7ffb65f0f85a5665d68bbebfb4c56e4
>>>>>>> 42b8c68a6b3e3ceb41f68f225e722ab4df25a304
>>>>>>> 41cbcef940efb197ef1c00de637fe545aa8e93ea
>>>>>>> 3d8de14eeb27d6b293c8027db75b8cf0eb66facd
      continue;
    }

    for (const val of docs) {
      if (val.$__ != null) {
        mpath.unset(foreignField, val._doc);
      } else {
        mpath.unset(foreignField, val);
      }
    }
  }
};
