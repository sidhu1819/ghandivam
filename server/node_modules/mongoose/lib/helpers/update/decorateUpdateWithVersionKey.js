'use strict';

/**
 * Decorate the update with a version key, if necessary
 * @api private
 */

module.exports = function decorateUpdateWithVersionKey(update, options, versionKey) {
  if (!versionKey || !(options && options.upsert || false)) {
    return;
  }

  if (options.overwrite) {
    if (!hasKey(update, versionKey)) {
      update[versionKey] = 0;
    }
  } else if (
    !hasKey(update, versionKey) &&
    !hasKey(update?.$set, versionKey) &&
    !hasKey(update?.$inc, versionKey) &&
    !hasKey(update?.$setOnInsert, versionKey)
  ) {
    if (!update.$setOnInsert) {
      update.$setOnInsert = {};
    }
    update.$setOnInsert[versionKey] = 0;
  }
};

function hasKey(obj, key) {
  if (obj == null || typeof obj !== 'object') {
    return false;
  }
<<<<<<< HEAD
  return Object.prototype.hasOwnProperty.call(obj, key);
=======
<<<<<<< HEAD
  return Object.prototype.hasOwnProperty.call(obj, key);
=======
<<<<<<< HEAD
  return Object.prototype.hasOwnProperty.call(obj, key);
=======
  return Object.hasOwn(obj, key);
>>>>>>> 15bede01c7ffb65f0f85a5665d68bbebfb4c56e4
>>>>>>> 42b8c68a6b3e3ceb41f68f225e722ab4df25a304
>>>>>>> 41cbcef940efb197ef1c00de637fe545aa8e93ea
}
